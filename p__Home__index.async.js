(self.webpackChunk=self.webpackChunk||[]).push([[371],{12282:function(ue,R,y){"use strict";y.r(R),y.d(R,{default:function(){return v}});var F=y(90228),Y=y.n(F),X=y(26068),Q=y.n(X),ne=y(87999),G=y.n(ne),ie=y(48305),l=y.n(ie),e=y(93236),t=y(23017),n=y(98868),i=y(32261),r=y(11609),u=y.n(r),o=y(62086),a=function(){var T=(0,e.useState)(0),w=l()(T,2),p=w[0],E=w[1],L=(0,e.useState)(),N=l()(L,2),D=N[0],B=N[1],z=(0,e.useState)(!1),O=l()(z,2),V=O[0],H=O[1],$=function(){var h=new(u())({positionMenu:!1,noMatchTemplate:function(){return'<li class="no-match">\u65E0\u5339\u914D\u7ED3\u679C</li>'},requireLeadingSpace:!0,menuContainer:document.getElementById("menuWrapper"),collection:[{selectTemplate:function(d){return this.range.isContentEditable(this.current.element)?'&nbsp;<a contenteditable="false" data-user='.concat(JSON.stringify(d.original),">@").concat(d.original.value,"</a>"):"@"+d.original.value},menuItemTemplate:function(d){var M=d.original,j=M.icon,P=M.name;return'<img class="publish-user-icon" src="'.concat(j,'"/><div class="publish-user-name">').concat(P,"</div>")},selectClass:"publish-highlight",itemClass:"publish-user-item",values:function(){var b=G()(Y()().mark(function M(j,P){var k,A;return Y()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return console.log("\u7528\u6237",j),S.next=3,(0,i.request)("https://codewan.cn/api/");case 3:k=S.sent,A=k.default.users.map(function(U){return Q()(Q()({},U),{},{key:U.name,value:U.name})}),P(A);case 6:case"end":return S.stop()}},M)}));function d(M,j){return b.apply(this,arguments)}return d}()},{trigger:"#",selectTemplate:function(d){return this.range.isContentEditable(this.current.element)?'&nbsp;<a contenteditable="false" data-topic='.concat(JSON.stringify(d.original),">#").concat(d.original.value,'<span class="content-hide">[\u8BDD\u9898]#</span></a>'):"#"+d.original.value},menuItemTemplate:function(d){var M=d.original.name;return'<span class="menu-item-string">#'.concat(M,'</span><span class="menu-item-number">12\u6B21\u6D4F\u89C8</span>')},selectClass:"publish-highlight",itemClass:"publish-topic-item",values:function(){var b=G()(Y()().mark(function M(j,P){var k,A;return Y()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(0,i.request)("https://codewan.cn/api/");case 2:k=S.sent,A=k.default.tags.map(function(U){return Q()(Q()({},U),{},{key:U.name,value:U.name})}),P(A);case 5:case"end":return S.stop()}},M)}));function d(M,j){return b.apply(this,arguments)}return d}()}]}),f=document.getElementById("contentEditor");h.attach(f);var g=document.getElementById("userBtn");g&&g.addEventListener("mousedown",function(b){b.preventDefault(),H(!1);var d=f;h.showMenuForCollection(d)});var x=document.getElementById("topicBtn");x&&x.addEventListener("mousedown",function(b){b.preventDefault(),H(!1);var d=f;h.showMenuForCollection(d,1)})};(0,e.useEffect)(function(){$()},[]);var K=function(h){if(!h)return 0;var f=h.innerHTML,g=f.match(/<img src/g)||[];return(f=f.replace(/<(\w+)(\s)class="content-hide([^>]*)>(.*?)<\/\1>/gi,"").replace(/<(\w+)([^>]*)class="data-clipboard-text-hide"([^>]*)>(.*?)<\/\1>/gi,"").replace(/(<([^>]+)>)/gi,"").replace(/[\r\n]/g,"").replace(/&nbsp;/g," ")).length+g.length},J=function(h){if(!h)return"";var f=h===null?void 0:h.innerHTML;f=f.replace(/<img([^>]+)data-set="x-x-/g,"").replace(/-x-x([^>]*)>/g,"").replace(/<br>/g,"<\u786C\u6362\u884C>").replace(/<(\w+)(\s)class="content-hide([^>]*)>(.*?)<\/\1>/gi,"[\u8BDD\u9898]#").replace(/<(\w+)([^>]*)class="data-clipboard-text-hide"([^>]*)>#<\/\1>/gi,"#");var g=document.createElement("div");g.innerHTML=f,document.body.append(g);var x=g.innerText.replace(/<硬换行>/g,`	
`);return document.body.removeChild(g),x},q=function(h){h.target.innerText===`
`&&(h.target.innerText="");var f=K(h.target);E(f)},re=function(){var h=[],f=[],g={},x={},b=document.getElementById("contentEditor"),d=Array.from(b==null?void 0:b.querySelectorAll("a"));d==null||d.forEach(function(j){var P=j.dataset,k=P.user,A=P.topic;if(A)try{if(A=JSON.parse(A),!A.id||g[A.id])return;g[A.id]=!0,h.push(A)}catch(C){}if(k)try{if(k=JSON.parse(k),!k.id||x[k.id])return;x[k.id]=!0,f.push(k)}catch(C){}});var M={content:J(document.getElementById("contentEditor")),users:f,topics:h};console.log("data",M),B(M)},oe=function(h){var f=document.getElementById("contentEditor");h.keyCode===8&&f.childElementCount===1&&/^<a.+<\/a>$/.test(f)&&(f.innerHTML="")},Z=function(){var h=document.querySelector(".tribute-container");h&&(h.style.display="none")},_=function(){H(!1)},ee=function(){var h,f,g,x,b,d=window.getSelection().anchorNode;return(d==null?void 0:d.id)==="contentEditor"||(d==null||(h=d.parentNode)===null||h===void 0?void 0:h.id)==="contentEditor"||((d==null||(f=d.parentNode)===null||f===void 0?void 0:f.tagName)==="DIV"||(d==null||(g=d.parentNode)===null||g===void 0?void 0:g.tagName)==="SPAN")&&(d==null||(x=d.parentNode)===null||x===void 0||(b=x.parentNode)===null||b===void 0?void 0:b.id)==="post-textarea"},te=function(){if(H(!0),!ee()){var h=document.createRange();h.selectNodeContents(document.getElementById("contentEditor")),h.collapse(!1);var f=window.getSelection();f.removeAllRanges(),f.addRange(h)}},W=function(h){if(ee()){var f=window.getSelection().getRangeAt(0),g=new Image;g.src=h.currentTarget.firstChild.src,g.width=22,g.style.position="relative",g.style.top="6px",g.style.marginTop="-6px",g.setAttribute("data-set","x-x-[".concat(h.currentTarget.lastChild.innerText,"R]-x-x")),f.insertNode(g),f.setEndAfter(g),f.collapse(!1);var x=document.getElementById("contentEditor"),b=J(x)||"";E(K(x)),H(!1)}};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"input-wrapper",children:[(0,o.jsx)("p",{id:"contentEditor",className:"content-editor ".concat(p>1e3?"textarea-error":""),placeholder:"\u586B\u5199\u66F4\u5168\u9762\u7684\u63CF\u8FF0\u4FE1\u606F\uFF0C\u8BA9\u66F4\u591A\u7684\u4EBA\u770B\u5230\u4F60\u5427\uFF01",onInput:q,onBlur:Z}),(0,o.jsxs)("div",{className:"length-wrapper",children:[(0,o.jsx)("span",{className:"length",children:p}),"/1000"]}),(0,o.jsxs)(t.Z,{children:[(0,o.jsx)(n.ZP,{id:"userBtn",children:"@\u7528\u6237"}),(0,o.jsx)(n.ZP,{id:"topicBtn",children:"#\u8BDD\u9898"}),(0,o.jsx)(n.ZP,{id:"faceBtn",onClick:te,children:"\u{1F601}\u8868\u60C5"}),(0,o.jsx)(n.ZP,{onClick:re,children:"\u83B7\u53D6\u6570\u636E"})]}),(0,o.jsx)("div",{id:"menuWrapper"}),V&&(0,o.jsx)("div",{className:"emoticons-container",children:(0,o.jsxs)("div",{className:"emoticons-content",children:[(0,o.jsx)("div",{className:"close-button",onClick:_,children:(0,o.jsx)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTUuNzA1ODMgNUw5Ljg0NDgyIDkuMTM4OThDMTAuMzE1NCA5LjYwOTU0IDkuNjA5NTQgMTAuMzE1NCA5LjEzODk4IDkuODQ0ODJMNSA1LjcwNTgzTDAuODYxMDE1IDkuODQ0ODJDMC4zOTA0NTkgMTAuMzE1NCAtMC4zMTUzNzUgOS42MDk1NCAwLjE1NTE4MSA5LjEzODk4TDQuMjk0MTcgNUwwLjE1NTE4MSAwLjg2MTAxNUMtMC4zMTUzNzUgMC4zOTA0NTkgMC4zOTA0NTkgLTAuMzE1Mzc1IDAuODYxMDE1IDAuMTU1MTgxTDUgNC4yOTQxN0w5LjEzODk4IDAuMTU1MTgxQzkuNjA5NTQgLTAuMzE1Mzc1IDEwLjMxNTQgMC4zOTA0NTkgOS44NDQ4MiAwLjg2MTAxNUw1LjcwNTgzIDVaIiBmaWxsPSIjODg4ODg4Ii8+Cjwvc3ZnPgo="})}),(0,o.jsx)("p",{children:"\u5E38\u7528\u8868\u60C5"}),(0,o.jsxs)("div",{className:"common-emoticons emoticons-layout",children:[(0,o.jsxs)("div",{className:"emoticons-item",onClick:W,children:[(0,o.jsx)("img",{src:"https://cdn.poizon.com/node-common/7e7105b963e3ddc04589e157829f4178.png"}),(0,o.jsx)("span",{className:"emoticons-title emoticons-title-show",children:"\u7231\u5FC3"})]}),(0,o.jsxs)("div",{className:"emoticons-item",onClick:W,children:[(0,o.jsx)("img",{src:"https://cdn.poizon.com/node-common/c75be1e96fea04fbd4e48cd2980dece9.png"}),(0,o.jsx)("span",{className:"emoticons-title emoticons-title-show",children:"\u6697\u559C"})]})]}),(0,o.jsx)("p",{children:"\u8001\u5F20\u8868\u60C5"}),(0,o.jsxs)("div",{className:"global-emoticons emoticons-layout",children:[(0,o.jsxs)("div",{className:"emoticons-item",onClick:W,children:[(0,o.jsx)("img",{src:"https://cdn.poizon.com/node-common/a760d9928c6a7fefcc9140365e3e9d38.png"}),(0,o.jsx)("span",{className:"emoticons-title emoticons-title-show",children:"\u4E0D\u7B80\u5355"})]}),(0,o.jsxs)("div",{className:"emoticons-item",onClick:W,children:[(0,o.jsx)("img",{src:"https://cdn.poizon.com/node-common/b21cdb30ba5ad35019c7e82ac962f30a.png"}),(0,o.jsx)("span",{className:"emoticons-title emoticons-title-show",children:"\u998B"})]})]})]})})]}),(0,o.jsx)("code",{style:{marginTop:"20px",display:"inline-block"},children:JSON.stringify(D,null,2)})]})},s=a,c=function(){return(0,o.jsx)("div",{children:(0,o.jsx)(s,{})})},v=c},11609:function(ue){(function(R,y){ue.exports=y()})(this,function(){"use strict";function R(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}function y(l,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(l,n.key,n)}}function F(l,e,t){return e&&y(l.prototype,e),t&&y(l,t),l}function Y(l,e){return function(t){if(Array.isArray(t))return t}(l)||function(t,n){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]"){var i=[],r=!0,u=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!n||i.length!==n);r=!0);}catch(c){u=!0,o=c}finally{try{r||s.return==null||s.return()}finally{if(u)throw o}}return i}}(l,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}if(Array.prototype.find||(Array.prototype.find=function(l){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof l!="function")throw new TypeError("predicate must be a function");for(var e,t=Object(this),n=t.length>>>0,i=arguments[1],r=0;r<n;r++)if(e=t[r],l.call(i,e,r,t))return e}),window&&typeof window.CustomEvent!="function"){var X=function(l,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(l,e.bubbles,e.cancelable,e.detail),t};window.Event!==void 0&&(X.prototype=window.Event.prototype),window.CustomEvent=X}var Q=function(){function l(e){R(this,l),this.tribute=e,this.tribute.events=this}return F(l,[{key:"bind",value:function(e){e.boundKeydown=this.keydown.bind(e,this),e.boundKeyup=this.keyup.bind(e,this),e.boundInput=this.input.bind(e,this),e.addEventListener("keydown",e.boundKeydown,!1),e.addEventListener("keyup",e.boundKeyup,!1),e.addEventListener("input",e.boundInput,!1)}},{key:"unbind",value:function(e){e.removeEventListener("keydown",e.boundKeydown,!1),e.removeEventListener("keyup",e.boundKeyup,!1),e.removeEventListener("input",e.boundInput,!1),delete e.boundKeydown,delete e.boundKeyup,delete e.boundInput}},{key:"keydown",value:function(e,t){e.shouldDeactivate(t)&&(e.tribute.isActive=!1,e.tribute.hideMenu());var n=this;e.commandEvent=!1,l.keys().forEach(function(i){i.key===t.keyCode&&(e.commandEvent=!0,e.callbacks()[i.value.toLowerCase()](t,n))})}},{key:"input",value:function(e,t){e.inputEvent=!0,e.keyup.call(this,e,t)}},{key:"click",value:function(e,t){var n=e.tribute;if(n.menu&&n.menu.contains(t.target)){var i=t.target;for(t.preventDefault(),t.stopPropagation();i.nodeName.toLowerCase()!=="li";)if(!(i=i.parentNode)||i===n.menu)throw new Error("cannot find the <li> container for the click");n.selectItemAtIndex(i.getAttribute("data-index"),t),n.hideMenu()}else n.current.element&&!n.current.externalTrigger&&(n.current.externalTrigger=!1,setTimeout(function(){return n.hideMenu()}))}},{key:"keyup",value:function(e,t){if(e.inputEvent&&(e.inputEvent=!1),e.updateSelection(this),t.keyCode!==27){if(!e.tribute.allowSpaces&&e.tribute.hasTrailingSpace)return e.tribute.hasTrailingSpace=!1,e.commandEvent=!0,void e.callbacks().space(t,this);if(!e.tribute.isActive)if(e.tribute.autocompleteMode)e.callbacks().triggerChar(t,this,"");else{var n=e.getKeyCode(e,this,t);if(isNaN(n)||!n)return;var i=e.tribute.triggers().find(function(r){return r.charCodeAt(0)===n});i!==void 0&&e.callbacks().triggerChar(t,this,i)}e.tribute.current.mentionText.length<e.tribute.current.collection.menuShowMinLength||((e.tribute.current.trigger||e.tribute.autocompleteMode)&&e.commandEvent===!1||e.tribute.isActive&&t.keyCode===8)&&e.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(e){if(!this.tribute.isActive)return!1;if(this.tribute.current.mentionText.length===0){var t=!1;return l.keys().forEach(function(n){e.keyCode===n.key&&(t=!0)}),!t}return!1}},{key:"getKeyCode",value:function(e,t,n){var i=e.tribute,r=i.range.getTriggerInfo(!1,i.hasTrailingSpace,!0,i.allowSpaces,i.autocompleteMode);return!!r&&r.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(e){this.tribute.current.element=e;var t=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);t&&(this.tribute.current.selectedPath=t.mentionSelectedPath,this.tribute.current.mentionText=t.mentionText,this.tribute.current.selectedOffset=t.mentionSelectedOffset)}},{key:"callbacks",value:function(){var e=this;return{triggerChar:function(t,n,i){var r=e.tribute;r.current.trigger=i;var u=r.collection.find(function(o){return o.trigger===i});r.current.collection=u,r.current.mentionText.length>=r.current.collection.menuShowMinLength&&r.inputEvent&&r.showMenuFor(n,!0)},enter:function(t,n){e.tribute.isActive&&e.tribute.current.filteredItems&&(t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.tribute.selectItemAtIndex(e.tribute.menuSelected,t),e.tribute.hideMenu()},0))},escape:function(t,n){e.tribute.isActive&&(t.preventDefault(),t.stopPropagation(),e.tribute.isActive=!1,e.tribute.hideMenu())},tab:function(t,n){e.callbacks().enter(t,n)},space:function(t,n){e.tribute.isActive&&(e.tribute.spaceSelectsMatch?e.callbacks().enter(t,n):e.tribute.allowSpaces||(t.stopPropagation(),setTimeout(function(){e.tribute.hideMenu(),e.tribute.isActive=!1},0)))},up:function(t,n){if(e.tribute.isActive&&e.tribute.current.filteredItems){t.preventDefault(),t.stopPropagation();var i=e.tribute.current.filteredItems.length,r=e.tribute.menuSelected;i>r&&r>0?(e.tribute.menuSelected--,e.setActiveLi()):r===0&&(e.tribute.menuSelected=i-1,e.setActiveLi(),e.tribute.menu.scrollTop=e.tribute.menu.scrollHeight)}},down:function(t,n){if(e.tribute.isActive&&e.tribute.current.filteredItems){t.preventDefault(),t.stopPropagation();var i=e.tribute.current.filteredItems.length-1,r=e.tribute.menuSelected;i>r?(e.tribute.menuSelected++,e.setActiveLi()):i===r&&(e.tribute.menuSelected=0,e.setActiveLi(),e.tribute.menu.scrollTop=0)}},delete:function(t,n){e.tribute.isActive&&e.tribute.current.mentionText.length<1?e.tribute.hideMenu():e.tribute.isActive&&e.tribute.showMenuFor(n)}}}},{key:"setActiveLi",value:function(e){var t=this.tribute.menu.querySelectorAll("li"),n=t.length>>>0;e&&(this.tribute.menuSelected=parseInt(e));for(var i=0;i<n;i++){var r=t[i];if(i===this.tribute.menuSelected){r.classList.add(this.tribute.current.collection.selectClass);var u=r.getBoundingClientRect(),o=this.tribute.menu.getBoundingClientRect();if(u.bottom>o.bottom){var a=u.bottom-o.bottom;this.tribute.menu.scrollTop+=a}else if(u.top<o.top){var s=o.top-u.top;this.tribute.menu.scrollTop-=s}}else r.classList.remove(this.tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function(e,t){var n=e.getBoundingClientRect().height;if(t){var i=e.currentStyle||window.getComputedStyle(e);return n+parseFloat(i.marginTop)+parseFloat(i.marginBottom)}return n}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),l}(),ne=function(){function l(e){R(this,l),this.tribute=e,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return F(l,[{key:"bind",value:function(e){var t=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.showMenuFor(t.tribute.current.element,!1)},300,!1),this.windowResizeEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.range.positionMenuAtCaret(!0)},300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function(e){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function(e,t,n){var i,r=arguments,u=this;return function(){var o=u,a=r,s=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s&&e.apply(o,a)}}}]),l}(),G=function(){function l(e){R(this,l),this.tribute=e,this.tribute.range=this}return F(l,[{key:"getDocument",value:function(){var e;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),e?e.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(e){var t,n=this,i=this.tribute.current,r=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(r!==void 0){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");t=this.isContentEditable(i.element)?this.getContentEditableCaretPosition(r.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,r.mentionPosition),this.tribute.menu.style.cssText="top: ".concat(t.top,`px;
                                     left: `).concat(t.left,`px;
                                     right: `).concat(t.right,`px;
                                     bottom: `).concat(t.bottom,`px;
                                     position: absolute;
                                     display: block;`),t.left==="auto"&&(this.tribute.menu.style.left="auto"),t.top==="auto"&&(this.tribute.menu.style.top="auto"),e&&this.scrollIntoView(),window.setTimeout(function(){var u={width:n.tribute.menu.offsetWidth,height:n.tribute.menu.offsetHeight},o=n.isMenuOffScreen(t,u),a=window.innerWidth>u.width&&(o.left||o.right),s=window.innerHeight>u.height&&(o.top||o.bottom);(a||s)&&(n.tribute.menu.style.cssText="display: none",n.positionMenuAtCaret(e))},0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(e,t,n){var i,r=e;if(t)for(var u=0;u<t.length;u++){if((r=r.childNodes[t[u]])===void 0)return;for(;r.length<n;)n-=r.length,r=r.nextSibling;r.childNodes.length!==0||r.length||(r=r.previousSibling)}var o=this.getWindowSelection();(i=this.getDocument().createRange()).setStart(r,n),i.setEnd(r,n),i.collapse(!0);try{o.removeAllRanges()}catch(a){}o.addRange(i),e.focus()}},{key:"replaceTriggerText",value:function(e,t,n,i,r){var u=this.getTriggerInfo(!0,n,t,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(u!==void 0){var o=this.tribute.current,a=new CustomEvent("tribute-replaced",{detail:{item:r,instance:o,context:u,event:i}});if(this.isContentEditable(o.element)){e+=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:"\xA0";var s=u.mentionPosition+u.mentionText.length;this.tribute.autocompleteMode||(s+=u.mentionTriggerChar.length),this.pasteHtml(e,u.mentionPosition,s)}else{var c=this.tribute.current.element,v=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:" ";e+=v;var m=u.mentionPosition,T=u.mentionPosition+u.mentionText.length+v.length;this.tribute.autocompleteMode||(T+=u.mentionTriggerChar.length-1),c.value=c.value.substring(0,m)+e+c.value.substring(T,c.value.length),c.selectionStart=m+e.length,c.selectionEnd=m+e.length}o.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),o.element.dispatchEvent(a)}}},{key:"pasteHtml",value:function(e,t,n){var i,r;r=this.getWindowSelection(),(i=this.getDocument().createRange()).setStart(r.anchorNode,t),i.setEnd(r.anchorNode,n),i.deleteContents();var u=this.getDocument().createElement("div");u.innerHTML=e;for(var o,a,s=this.getDocument().createDocumentFragment();o=u.firstChild;)a=s.appendChild(o);i.insertNode(s),a&&((i=i.cloneRange()).setStartAfter(a),i.collapse(!0),r.removeAllRanges(),r.addRange(i))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(e){if(e.parentNode===null)return 0;for(var t=0;t<e.parentNode.childNodes.length;t++)if(e.parentNode.childNodes[t]===e)return t}},{key:"getContentEditableSelectedPath",value:function(e){var t=this.getWindowSelection(),n=t.anchorNode,i=[];if(n!=null){for(var r,u=n.contentEditable;n!==null&&u!=="true";)r=this.getNodePositionInParent(n),i.push(r),(n=n.parentNode)!==null&&(u=n.contentEditable);return i.reverse(),{selected:n,path:i,offset:t.getRangeAt(0).startOffset}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var e=this.tribute.current,t="";if(this.isContentEditable(e.element)){var n=this.getWindowSelection().anchorNode;if(n!=null){var i=n.textContent,r=this.getWindowSelection().getRangeAt(0).startOffset;i&&r>=0&&(t=i.substring(0,r))}}else{var u=this.tribute.current.element;if(u){var o=u.selectionStart;u.value&&o>=0&&(t=u.value.substring(0,o))}}return t}},{key:"getLastWordInText",value:function(e){var t=(e=e.replace(/\u00A0/g," ")).split(/\s+/);return t[t.length-1].trim()}},{key:"getTriggerInfo",value:function(e,t,n,i,r){var u,o,a,s=this,c=this.tribute.current;if(this.isContentEditable(c.element)){var v=this.getContentEditableSelectedPath(c);v&&(u=v.selected,o=v.path,a=v.offset)}else u=this.tribute.current.element;var m=this.getTextPrecedingCurrentSelection(),T=this.getLastWordInText(m);if(r)return{mentionPosition:m.length-T.length,mentionText:T,mentionSelectedElement:u,mentionSelectedPath:o,mentionSelectedOffset:a};if(m!=null){var w,p=-1;if(this.tribute.collection.forEach(function(B){var z=B.trigger,O=B.requireLeadingSpace?s.lastIndexWithLeadingSpace(m,z):m.lastIndexOf(z);O>p&&(p=O,w=z,n=B.requireLeadingSpace)}),p>=0&&(p===0||!n||/[\xA0\s]/g.test(m.substring(p-1,p)))){var E=m.substring(p+w.length,m.length);w=m.substring(p,p+w.length);var L=E.substring(0,1),N=E.length>0&&(L===" "||L==="\xA0");t&&(E=E.trim());var D=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=D.test(E),!N&&(e||!D.test(E)))return{mentionPosition:p,mentionText:E,mentionSelectedElement:u,mentionSelectedPath:o,mentionSelectedOffset:a,mentionTriggerChar:w}}}}},{key:"lastIndexWithLeadingSpace",value:function(e,t){for(var n=e.split("").reverse().join(""),i=-1,r=0,u=e.length;r<u;r++){for(var o=r===e.length-1,a=/\s/.test(n[r+1]),s=!0,c=t.length-1;c>=0;c--)if(t[c]!==n[r-c]){s=!1;break}if(s&&(o||a)){i=e.length-1-r;break}}return i}},{key:"isContentEditable",value:function(e){return e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"}},{key:"isMenuOffScreen",value:function(e,t){var n=window.innerWidth,i=window.innerHeight,r=document.documentElement,u=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),o=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),a=typeof e.top=="number"?e.top:o+i-e.bottom-t.height,s=typeof e.right=="number"?e.right:e.left+t.width,c=typeof e.bottom=="number"?e.bottom:e.top+t.height,v=typeof e.left=="number"?e.left:u+n-e.right-t.width;return{top:a<Math.floor(o),right:s>Math.ceil(u+n),bottom:c>Math.ceil(o+i),left:v<Math.floor(u)}}},{key:"getMenuDimensions",value:function(){var e={width:null,height:null};return this.tribute.menu.style.cssText=`top: 0px;
                                 left: 0px;
                                 position: fixed;
                                 display: block;
                                 visibility; hidden;`,e.width=this.tribute.menu.offsetWidth,e.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",e}},{key:"getTextAreaOrInputUnderlinePosition",value:function(e,t,n){var i=window.mozInnerScreenX!==null,r=this.getDocument().createElement("div");r.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(r);var u=r.style,o=window.getComputedStyle?getComputedStyle(e):e.currentStyle;u.whiteSpace="pre-wrap",e.nodeName!=="INPUT"&&(u.wordWrap="break-word"),u.position="absolute",u.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(function(O){u[O]=o[O]}),i?(u.width="".concat(parseInt(o.width)-2,"px"),e.scrollHeight>parseInt(o.height)&&(u.overflowY="scroll")):u.overflow="hidden",r.textContent=e.value.substring(0,t),e.nodeName==="INPUT"&&(r.textContent=r.textContent.replace(/\s/g,"\xA0"));var a=this.getDocument().createElement("span");a.textContent=e.value.substring(t)||".",r.appendChild(a);var s=e.getBoundingClientRect(),c=document.documentElement,v=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),m=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),T=0,w=0;this.menuContainerIsBody&&(T=s.top,w=s.left);var p={top:T+m+a.offsetTop+parseInt(o.borderTopWidth)+parseInt(o.fontSize)-e.scrollTop,left:w+v+a.offsetLeft+parseInt(o.borderLeftWidth)},E=window.innerWidth,L=window.innerHeight,N=this.getMenuDimensions(),D=this.isMenuOffScreen(p,N);D.right&&(p.right=E-p.left,p.left="auto");var B=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(D.bottom){var z=B-(L-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);p.bottom=z+(L-s.top-a.offsetTop),p.top="auto"}return(D=this.isMenuOffScreen(p,N)).left&&(p.left=E>N.width?v+E-N.width:v,delete p.right),D.top&&(p.top=L>N.height?m+L-N.height:m,delete p.bottom),this.getDocument().body.removeChild(r),p}},{key:"getContentEditableCaretPosition",value:function(e){var t,n=this.getWindowSelection();(t=this.getDocument().createRange()).setStart(n.anchorNode,e),t.setEnd(n.anchorNode,e),t.collapse(!1);var i=t.getBoundingClientRect(),r=document.documentElement,u=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),o=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),a={left:i.left+u,top:i.top+i.height+o},s=window.innerWidth,c=window.innerHeight,v=this.getMenuDimensions(),m=this.isMenuOffScreen(a,v);m.right&&(a.left="auto",a.right=s-i.left-u);var T=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(m.bottom){var w=T-(c-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);a.top="auto",a.bottom=w+(c-i.top)}return(m=this.isMenuOffScreen(a,v)).left&&(a.left=s>v.width?u+s-v.width:u,delete a.right),m.top&&(a.top=c>v.height?o+c-v.height:o,delete a.bottom),this.menuContainerIsBody||(a.left=a.left?a.left-this.tribute.menuContainer.offsetLeft:a.left,a.top=a.top?a.top-this.tribute.menuContainer.offsetTop:a.top),a}},{key:"scrollIntoView",value:function(e){var t,n=this.menu;if(n!==void 0){for(;t===void 0||t.height===0;)if((t=n.getBoundingClientRect()).height===0&&((n=n.childNodes[0])===void 0||!n.getBoundingClientRect))return;var i=t.top,r=i+t.height;if(i<0)window.scrollTo(0,window.pageYOffset+t.top-20);else if(r>window.innerHeight){var u=window.pageYOffset+t.top-20;u-window.pageYOffset>100&&(u=window.pageYOffset+100);var o=window.pageYOffset-(window.innerHeight-r);o>u&&(o=u),window.scrollTo(0,o)}}}},{key:"menuContainerIsBody",get:function(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}}]),l}(),ie=function(){function l(e){R(this,l),this.tribute=e,this.tribute.search=this}return F(l,[{key:"simpleFilter",value:function(e,t){var n=this;return t.filter(function(i){return n.test(e,i)})}},{key:"test",value:function(e,t){return this.match(e,t)!==null}},{key:"match",value:function(e,t,n){n=n||{},t.length;var i=n.pre||"",r=n.post||"",u=n.caseSensitive&&t||t.toLowerCase();if(n.skip)return{rendered:t,score:0};e=n.caseSensitive&&e||e.toLowerCase();var o=this.traverse(u,e,0,0,[]);return o?{rendered:this.render(t,o.cache,i,r),score:o.score}:null}},{key:"traverse",value:function(e,t,n,i,r){if(t.length===i)return{score:this.calculateScore(r),cache:r.slice()};if(!(e.length===n||t.length-i>e.length-n)){for(var u,o,a=t[i],s=e.indexOf(a,n);s>-1;){if(r.push(s),o=this.traverse(e,t,s+1,i+1,r),r.pop(),!o)return u;(!u||u.score<o.score)&&(u=o),s=e.indexOf(a,s+1)}return u}}},{key:"calculateScore",value:function(e){var t=0,n=1;return e.forEach(function(i,r){r>0&&(e[r-1]+1===i?n+=n+1:n=1),t+=n}),t}},{key:"render",value:function(e,t,n,i){var r=e.substring(0,t[0]);return t.forEach(function(u,o){r+=n+e[u]+i+e.substring(u+1,t[o+1]?t[o+1]:e.length)}),r}},{key:"filter",value:function(e,t,n){var i=this;return n=n||{},t.reduce(function(r,u,o,a){var s=u;n.extract&&((s=n.extract(u))||(s=""));var c=i.match(e,s,n);return c!=null&&(r[r.length]={string:c.rendered,score:c.score,index:o,original:u}),r},[]).sort(function(r,u){var o=u.score-r.score;return o||r.index-u.index})}}]),l}();return function(){function l(e){var t,n=this,i=e.values,r=i===void 0?null:i,u=e.iframe,o=u===void 0?null:u,a=e.selectClass,s=a===void 0?"highlight":a,c=e.containerClass,v=c===void 0?"tribute-container":c,m=e.itemClass,T=m===void 0?"":m,w=e.trigger,p=w===void 0?"@":w,E=e.autocompleteMode,L=E!==void 0&&E,N=e.selectTemplate,D=N===void 0?null:N,B=e.menuItemTemplate,z=B===void 0?null:B,O=e.lookup,V=O===void 0?"key":O,H=e.fillAttr,$=H===void 0?"value":H,K=e.collection,J=K===void 0?null:K,q=e.menuContainer,re=q===void 0?null:q,oe=e.noMatchTemplate,Z=oe===void 0?null:oe,_=e.requireLeadingSpace,ee=_===void 0||_,te=e.allowSpaces,W=te!==void 0&&te,I=e.replaceTextSuffix,h=I===void 0?null:I,f=e.positionMenu,g=f===void 0||f,x=e.spaceSelectsMatch,b=x!==void 0&&x,d=e.searchOpts,M=d===void 0?{}:d,j=e.menuItemLimit,P=j===void 0?null:j,k=e.menuShowMinLength,A=k===void 0?0:k;if(R(this,l),this.autocompleteMode=L,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=re,this.allowSpaces=W,this.replaceTextSuffix=h,this.positionMenu=g,this.hasTrailingSpace=!1,this.spaceSelectsMatch=b,this.autocompleteMode&&(p="",W=!1),r)this.collection=[{trigger:p,iframe:o,selectClass:s,containerClass:v,itemClass:T,selectTemplate:(D||l.defaultSelectTemplate).bind(this),menuItemTemplate:(z||l.defaultMenuItemTemplate).bind(this),noMatchTemplate:(t=Z,typeof t=="string"?t.trim()===""?null:t:typeof t=="function"?t.bind(n):Z||function(){return"<li>No Match Found!</li>"}.bind(n)),lookup:V,fillAttr:$,values:r,requireLeadingSpace:ee,searchOpts:M,menuItemLimit:P,menuShowMinLength:A}];else{if(!J)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=J.map(function(C){return{trigger:C.trigger||p,iframe:C.iframe||o,selectClass:C.selectClass||s,containerClass:C.containerClass||v,itemClass:C.itemClass||T,selectTemplate:(C.selectTemplate||l.defaultSelectTemplate).bind(n),menuItemTemplate:(C.menuItemTemplate||l.defaultMenuItemTemplate).bind(n),noMatchTemplate:function(S){return typeof S=="string"?S.trim()===""?null:S:typeof S=="function"?S.bind(n):Z||function(){return"<li>No Match Found!</li>"}.bind(n)}(Z),lookup:C.lookup||V,fillAttr:C.fillAttr||$,values:C.values,requireLeadingSpace:C.requireLeadingSpace,searchOpts:C.searchOpts||M,menuItemLimit:C.menuItemLimit||P,menuShowMinLength:C.menuShowMinLength||A}})}new G(this),new Q(this),new ne(this),new ie(this)}return F(l,[{key:"triggers",value:function(){return this.collection.map(function(e){return e.trigger})}},{key:"attach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery!="undefined"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var t=e.length,n=0;n<t;++n)this._attach(e[n]);else this._attach(e)}},{key:"_attach",value:function(e){e.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+e.nodeName),this.ensureEditable(e),this.events.bind(e),e.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(e){if(l.inputTypes().indexOf(e.nodeName)===-1){if(!e.contentEditable)throw new Error("[Tribute] Cannot bind to "+e.nodeName);e.contentEditable=!0}}},{key:"createMenu",value:function(e){var t=this.range.getDocument().createElement("div"),n=this.range.getDocument().createElement("ul");return t.className=e,t.appendChild(n),this.menuContainer?this.menuContainer.appendChild(t):this.range.getDocument().body.appendChild(t)}},{key:"showMenuFor",value:function(e,t){var n=this;if(!this.isActive||this.current.element!==e||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),e.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var i=function(r){if(n.isActive){var u=n.search.filter(n.current.mentionText,r,{pre:n.current.collection.searchOpts.pre||"<span>",post:n.current.collection.searchOpts.post||"</span>",skip:n.current.collection.searchOpts.skip,extract:function(c){if(typeof n.current.collection.lookup=="string")return c[n.current.collection.lookup];if(typeof n.current.collection.lookup=="function")return n.current.collection.lookup(c,n.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});n.current.collection.menuItemLimit&&(u=u.slice(0,n.current.collection.menuItemLimit)),n.current.filteredItems=u;var o=n.menu.querySelector("ul");if(n.range.positionMenuAtCaret(t),!u.length){var a=new CustomEvent("tribute-no-match",{detail:n.menu});return n.current.element.dispatchEvent(a),void(typeof n.current.collection.noMatchTemplate=="function"&&!n.current.collection.noMatchTemplate()||!n.current.collection.noMatchTemplate?n.hideMenu():typeof n.current.collection.noMatchTemplate=="function"?o.innerHTML=n.current.collection.noMatchTemplate():o.innerHTML=n.current.collection.noMatchTemplate)}o.innerHTML="";var s=n.range.getDocument().createDocumentFragment();u.forEach(function(c,v){var m=n.range.getDocument().createElement("li");m.setAttribute("data-index",v),m.className=n.current.collection.itemClass,m.addEventListener("mousemove",function(T){var w=Y(n._findLiTarget(T.target),2),p=(w[0],w[1]);T.movementY!==0&&n.events.setActiveLi(p)}),n.menuSelected===v&&m.classList.add(n.current.collection.selectClass),m.innerHTML=n.current.collection.menuItemTemplate(c),s.appendChild(m)}),o.appendChild(s)}};typeof this.current.collection.values=="function"?this.current.collection.values(this.current.mentionText,i):i(this.current.collection.values)}}},{key:"_findLiTarget",value:function(e){if(!e)return[];var t=e.getAttribute("data-index");return t?[e,t]:this._findLiTarget(e.parentNode)}},{key:"showMenuForCollection",value:function(e,t){e!==document.activeElement&&this.placeCaretAtEnd(e),this.current.collection=this.collection[t||0],this.current.externalTrigger=!0,this.current.element=e,e.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(e,this.current.collection.trigger),this.showMenuFor(e)}},{key:"placeCaretAtEnd",value:function(e){if(e.focus(),window.getSelection!==void 0&&document.createRange!==void 0){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(document.body.createTextRange!==void 0){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}},{key:"insertTextAtCursor",value:function(e){var t,n;(n=(t=window.getSelection()).getRangeAt(0)).deleteContents();var i=document.createTextNode(e);n.insertNode(i),n.selectNodeContents(i),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}},{key:"insertAtCaret",value:function(e,t){var n=e.scrollTop,i=e.selectionStart,r=e.value.substring(0,i),u=e.value.substring(e.selectionEnd,e.value.length);e.value=r+t+u,i+=t.length,e.selectionStart=i,e.selectionEnd=i,e.focus(),e.scrollTop=n}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(e,t){if(typeof(e=parseInt(e))=="number"&&!isNaN(e)){var n=this.current.filteredItems[e],i=this.current.collection.selectTemplate(n);i!==null&&this.replaceText(i,t,n)}}},{key:"replaceText",value:function(e,t,n){this.range.replaceTriggerText(e,!0,!0,t,n)}},{key:"_append",value:function(e,t,n){if(typeof e.values=="function")throw new Error("Unable to append to values, as it is a function.");e.values=n?t:e.values.concat(t)}},{key:"append",value:function(e,t,n){var i=parseInt(e);if(typeof i!="number")throw new Error("please provide an index for the collection to update.");var r=this.collection[i];this._append(r,t,n)}},{key:"appendCurrent",value:function(e,t){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,e,t)}},{key:"detach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery!="undefined"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var t=e.length,n=0;n<t;++n)this._detach(e[n]);else this._detach(e)}},{key:"_detach",value:function(e){var t=this;this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),setTimeout(function(){e.removeAttribute("data-tribute"),t.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}},{key:"isActive",get:function(){return this._isActive},set:function(e){if(this._isActive!=e&&(this._isActive=e,this.current.element)){var t=new CustomEvent("tribute-active-".concat(e));this.current.element.dispatchEvent(t)}}}],[{key:"defaultSelectTemplate",value:function(e){return e===void 0?"".concat(this.current.collection.trigger).concat(this.current.mentionText):this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+e.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+e.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(e){return e.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),l}()})}}]);
